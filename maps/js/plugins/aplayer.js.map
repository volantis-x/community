{"version":3,"sources":["js/plugins/aplayer.js"],"names":["RightMenuAplayer","playStatus","APlayer","fn","undefined","player","setAPlayerObject","observer","setAPlayerObserver","meting","document","querySelectorAll","length","forEach","item","index","meta","id","volantis","GLOBAL_CONFIG","plugins","aplayer","updateTitle","on","e","updateAPlayerControllerStatus","status","onUpdateAPlayerVolume","volumeBarWrap","getElementsByClassName","children","volumeBar","thumbMove","updateAPlayerVolume","thumbUp","classList","remove","removeEventListener","addEventListener","event","stopPropagation","add","error","console","log","percentage","clientX","changedTouches","getBoundingClientRect","left","clientWidth","Math","max","min","volume","style","width","audio","paused","checkAPlayer","toggle","skipBack","play","skipForward","percent","list","obj","audios","innerHTML","title","aplayerBackward","aplayerToggle","aplayerForward","Object","freeze","requestAnimationFrame"],"mappings":"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","file":"../../../js/plugins/aplayer.js","sourcesContent":["/**\n * 右键音乐\n * */\nconst RightMenuAplayer = (() => {\n  let playStatus; // 播放器状态\n  const APlayer = {}; // 右键音乐所控制的播放器\n  const fn = {};\n\n  fn.checkAPlayer = () => {\n    if (playStatus === undefined || APlayer.player === undefined) {\n      fn.setAPlayerObject();\n    } else if (APlayer.observer === undefined) {\n      fn.setAPlayerObserver();\n    }\n  }\n\n  // 设置全局播放器所对应的 aplyer 对象\n  fn.setAPlayerObject = () => {\n    let meting = document.querySelectorAll('.footer meting-js');\n    if (meting.length == 0) {\n      meting = document.querySelectorAll('meting-js');\n    }\n    APlayer.player = undefined;\n    meting.forEach((item, index) => {\n      if (item.meta.id == volantis.GLOBAL_CONFIG.plugins.aplayer.id && item.aplayer && APlayer.player === undefined) {\n        APlayer.player = item.aplayer;\n        fn.setAPlayerObserver();\n        fn.updateTitle();\n      }\n    });\n  }\n\n  // 事件监听\n  fn.setAPlayerObserver = () => {\n    try {\n      APlayer.player.on('play', function (e) {\n        fn.updateAPlayerControllerStatus(e);\n        APlayer.status = 'play';\n      });\n      APlayer.player.on('pause', function (e) {\n        fn.updateAPlayerControllerStatus(e);\n        APlayer.status = 'pause';\n      });\n      APlayer.player.on('volumechange', function (e) {\n        fn.onUpdateAPlayerVolume(e);\n      });\n      APlayer.player.on('loadstart', function (e) {\n        fn.updateTitle(e);\n      });\n\n      // 监听音量手势\n      APlayer.volumeBarWrap = document.getElementsByClassName('nav volume')[0].children[0];\n      APlayer.volumeBar = APlayer.volumeBarWrap.children[0];\n\n      const thumbMove = (e) => {\n        fn.updateAPlayerVolume(e);\n      };\n\n      const thumbUp = (e) => {\n        APlayer.volumeBarWrap.classList.remove('aplayer-volume-bar-wrap-active');\n        document.removeEventListener('mouseup', thumbUp);\n        document.removeEventListener('mousemove', thumbMove);\n        fn.updateAPlayerVolume(e);\n      };\n\n      APlayer.volumeBarWrap.addEventListener('mousedown', (event) => {\n        event.stopPropagation();\n        APlayer.volumeBarWrap.classList.add('aplayer-volume-bar-wrap-active');\n        document.addEventListener('mousemove', thumbMove);\n        document.addEventListener('mouseup', thumbUp);\n      });\n\n      APlayer.volumeBarWrap.addEventListener('click', (event) => {\n        event.stopPropagation();\n      });\n\n      fn.updateAPlayerControllerStatus();\n      fn.onUpdateAPlayerVolume();\n      APlayer.observer = true;\n    } catch (error) {\n      console.log(error);\n      APlayer.observer = undefined;\n    }\n  }\n\n  fn.updateAPlayerVolume = (e) => {\n    let percentage = ((e.clientX || e.changedTouches[0].clientX) -\n      APlayer.volumeBar.getBoundingClientRect().left) / APlayer.volumeBar.clientWidth;\n    percentage = Math.max(percentage, 0);\n    percentage = Math.min(percentage, 1);\n    APlayer.player.volume(percentage);\n  }\n\n  fn.onUpdateAPlayerVolume = () => {\n    try {\n      APlayer.volumeBar.children[0].style.width = APlayer.player.audio.volume * 100 + '%';\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  // 更新控制器状态\n  fn.updateAPlayerControllerStatus = () => {\n    try {\n      if (APlayer.player.audio.paused) {\n        playStatus = 'pause';\n        document.getElementsByClassName('nav toggle')[0].children[0].classList.add('fa-play');\n        document.getElementsByClassName('nav toggle')[0].children[0].classList.remove('fa-pause');\n      } else {\n        playStatus = 'play';\n        document.getElementsByClassName('nav toggle')[0].children[0].classList.remove('fa-play');\n        document.getElementsByClassName('nav toggle')[0].children[0].classList.add('fa-pause');\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  // 播放/暂停\n  fn.aplayerToggle = () => {\n    fn.checkAPlayer();\n    try {\n      APlayer.player.toggle();\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  // 上一曲\n  fn.aplayerBackward = () => {\n    fn.checkAPlayer();\n    try {\n      APlayer.player.skipBack();\n      APlayer.player.play();\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  // 下一曲\n  fn.aplayerForward = () => {\n    fn.checkAPlayer();\n    try {\n      APlayer.player.skipForward();\n      APlayer.player.play();\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  // 调节音量\n  fn.aplayerVolume = (percent) => {\n    fn.checkAPlayer();\n    try {\n      APlayer.player.volume(percent);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  // 更新音乐标题\n  fn.updateTitle = () => {\n    fn.checkAPlayer();\n    try {\n      const index = APlayer.player.list.index;\n      const obj = APlayer.player.list.audios[index];\n      document.getElementsByClassName('nav music-title')[0].innerHTML = obj.title;\n    } catch (error) {\n      //console.log(error);\n    }\n  }\n\n  return {\n    checkAPlayer: fn.checkAPlayer,\n    aplayerBackward: fn.aplayerBackward,\n    aplayerToggle: fn.aplayerToggle,\n    aplayerForward: fn.aplayerForward,\n    APlayer: APlayer\n  }\n})()\n\nObject.freeze(RightMenuAplayer);\n\nvolantis.requestAnimationFrame(() => {\n  RightMenuAplayer.checkAPlayer();\n});\n"]}