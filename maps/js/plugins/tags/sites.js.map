{"version":3,"sources":["js/plugins/tags/sites.js"],"names":["_createForOfIteratorHelper","r","e","t","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","_n","F","s","n","done","value","f","TypeError","o","a","u","call","next","_arrayLikeToArray","toString","slice","constructor","name","from","test","SitesJS","requestAPI","url","callback","timeout","retryTimes","request","Promise","resolve","reject","status","timer","setTimeout","fetch","then","response","clearTimeout","ok","json","Error","data","error","layout","cfg","el","api","querySelector","remove","arr","content","cellALL","forEach","item","i","cell","title","cover","snapshot","screenshot","icon","avatar","description","_step","_iterator","labels","label","lightness","concat","color","hue","saturation","err","innerHTML","innerText","start","els","document","getElementsByClassName","getAttribute","Object","volantis","GLOBAL_CONFIG","link"],"mappings":"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","file":"../../../../js/plugins/tags/sites.js","sourcesContent":["const SitesJS = {\n  requestAPI: (url, callback, timeout) => {\n    let retryTimes = 5;\n\n    function request() {\n      return new Promise((resolve, reject) => {\n        let status = 0; // 0 等待 1 完成 2 超时\n        let timer = setTimeout(() => {\n          if (status === 0) {\n            status = 2;\n            timer = null;\n            reject('请求超时');\n            if (retryTimes == 0) {\n              timeout();\n            }\n          }\n        }, 5000);\n        fetch(url).then(function (response) {\n          if (status !== 2) {\n            clearTimeout(timer);\n            resolve(response);\n            timer = null;\n            status = 1;\n          }\n          if (response.ok) {\n            return response.json();\n          }\n          throw new Error('Network response was not ok.');\n        }).then(function (data) {\n          retryTimes = 0;\n          callback(data);\n        }).catch(function (error) {\n          if (retryTimes > 0) {\n            retryTimes -= 1;\n            setTimeout(() => {\n              request();\n            }, 5000);\n          } else {\n            timeout();\n          }\n        });\n      });\n    }\n    request();\n  },\n  layout: (cfg) => {\n    const el = cfg.el;\n    SitesJS.requestAPI(cfg.api, function (data) {\n      el.querySelector('.loading-wrap').remove();\n      const arr = data.content;\n      var cellALL = \"\";\n      arr.forEach((item, i) => {\n        var cell = '<div class=\"site-card\">';\n        cell += '<a class=\"card-link\" target=\"_blank\" rel=\"external noopener noreferrer\" href=\"' + item.url + '\">';\n        cell += '<img alt=\"' + item.title + '\" src=\"' + (item.cover || item.snapshot || item.screenshot || ('https://image.thum.io/get/width/1024/crop/768/' + item.url)) + '\" onerror=\"errorImgCover(this)\"/>';\n        cell += '<div class=\"info\">';\n        cell += '<img alt=\"' + item.title + '\" src=\"' + (item.icon || item.avatar || cfg.avatar) + '\" onerror=\"errorImgAvatar(this)\"/>';\n        cell += '<span class=\"title\">' + item.title + '</span>';\n        cell += '<span class=\"desc\">' + (item.description || item.url) + '</span>';\n        cell += '</div>';\n        cell += `<div class=\"labels\">`;\n        for (let label of item.labels) {\n          if (label.lightness > 75) {\n            cell += `<div class=\"label\" style=\"background:#${label.color};color:hsla(${label.hue}, ${label.saturation}%, 20%, 1);\">${label.name}</div>`;\n          } else if (label.saturation > 90 && label.lightness > 40) {\n            cell += `<div class=\"label\" style=\"background:#${label.color};color:hsla(${label.hue}, 50%, 20%, 1);\">${label.name}</div>`;\n          } else {\n            cell += `<div class=\"label\" style=\"background:#${label.color};color:white\">${label.name}</div>`;\n          }\n        }\n        cell += `</div>`;\n        cell += '</a>';\n        cell += '</div>';\n        cellALL += cell;\n      });\n      el.querySelector('.group-body').innerHTML = cellALL;\n    }, function () {\n      try {\n        el.querySelector('.loading-wrap svg').remove();\n        el.querySelector('.loading-wrap p').innerText('加载失败，请稍后重试。');\n      } catch (e) { }\n    });\n  },\n  start: (cfg) => {\n    const els = document.getElementsByClassName('sitesjs-wrap');\n    for (var i = 0; i < els.length; i++) {\n      const el = els[i];\n      const api = el.getAttribute('api');\n      if (api == null) {\n        continue;\n      }\n      var cfg = new Object();\n      cfg.class = el.getAttribute('class');\n      cfg.el = el;\n      cfg.api = api;\n      cfg.avatar = volantis.GLOBAL_CONFIG.default.link;\n      cfg.screenshot = volantis.GLOBAL_CONFIG.default.cover;\n      SitesJS.layout(cfg);\n    }\n  }\n}\n\n\nSitesJS.start();"]}