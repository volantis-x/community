{"version":3,"sources":["js/plugins/tags/fposts.js"],"names":["_createForOfIteratorHelper","r","e","t","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","_n","F","s","n","done","value","f","TypeError","o","a","u","call","next","_arrayLikeToArray","toString","slice","constructor","name","from","test","FpostsJS","requestAPI","url","callback","timeout","retryTimes","request","Promise","resolve","reject","status","timer","setTimeout","fetch","then","response","clearTimeout","ok","json","Error","data","error","layout","cfg","el","default_avatar","avatar","api","querySelector","remove","arr","content","cellALL","forEach","item","i","_item$posts","cell","concat","html_url","avatar_url","icon","title","login","_step","_iterator","labels","label","lightness","color","hue","saturation","err","description","issue_number","posts","_step2","_iterator2","post","link","published","_item$feed","feed","innerHTML","innerText","start","els","document","getElementsByClassName","getAttribute","Object","volantis","GLOBAL_CONFIG"],"mappings":"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","file":"../../../../js/plugins/tags/fposts.js","sourcesContent":["const FpostsJS = {\n  requestAPI: (url, callback, timeout) => {\n    let retryTimes = 5;\n\n    function request() {\n      return new Promise((resolve, reject) => {\n        let status = 0; // 0 等待 1 完成 2 超时\n        let timer = setTimeout(() => {\n          if (status === 0) {\n            status = 2;\n            timer = null;\n            reject('请求超时');\n            if (retryTimes == 0) {\n              timeout();\n            }\n          }\n        }, 5000);\n        fetch(url).then(function (response) {\n          if (status !== 2) {\n            clearTimeout(timer);\n            resolve(response);\n            timer = null;\n            status = 1;\n          }\n          if (response.ok) {\n            return response.json();\n          }\n          throw new Error('Network response was not ok.');\n        }).then(function (data) {\n          retryTimes = 0;\n          callback(data);\n        }).catch(function (error) {\n          if (retryTimes > 0) {\n            retryTimes -= 1;\n            setTimeout(() => {\n              request();\n            }, 5000);\n          } else {\n            timeout();\n          }\n        });\n      });\n    }\n    request();\n  },\n  layout: (cfg) => {\n    const el = cfg.el;\n    const default_avatar = cfg.avatar;\n    \n    FpostsJS.requestAPI(cfg.api, function (data) {\n      el.querySelector('.loading-wrap').remove();\n      const arr = data.content;\n      var cellALL = \"\";\n      arr.forEach((item, i) => {\n        var cell = `<div class=\"grid-cell user-post-card\">`;\n        cell += `<div class=\"avatar-box\">`;\n        cell += `<a class=\"card-link\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\" href=\"${item.html_url || item.url}\">`;;\n        cell += `<img src=\"${item.avatar_url || item.avatar || item.icon || default_avatar}\" onerror=\"javascript:this.removeAttribute(\\'data-src\\');this.src=\\'${default_avatar}\\';\"/>`;\n        cell += `<span class=\"title\">${item.title || item.login}</span>`;\n        cell += `</a>`;\n        cell += `<div class=\"labels\">`;\n        for (let label of item.labels) {\n          if (label.lightness > 75) {\n            cell += `<div class=\"label\" style=\"background:#${label.color};color:hsla(${label.hue}, ${label.saturation}%, 20%, 1);\">${label.name}</div>`;\n          } else if (label.saturation > 90 && label.lightness > 40) {\n            cell += `<div class=\"label\" style=\"background:#${label.color};color:hsla(${label.hue}, 50%, 20%, 1);\">${label.name}</div>`;\n          } else {\n            cell += `<div class=\"label\" style=\"background:#${label.color};color:white\">${label.name}</div>`;\n          }\n        }\n        cell += `</div>`;\n        cell += `</div>`;\n        cell += `<div class=\"previews\">`;\n        if (item.description) {\n          cell += `<div class=\"desc\">${item.description || item.issue_number || ''}</div>`;\n        } else {\n          cell += `<div class=\"desc\">#${item.issue_number}</div>`;\n        }\n        cell += `<div class=\"posts\">`;\n        \n        if (item.posts?.length > 0) {\n          for (let post of item.posts) {\n            cell += `<a class=\"post-link\" target=\"_blank\" rel=\"external nofollow noopener noreferrer\" href=\"${post.link}\">`;\n            cell += `<span class=\"title\">${post.title}</span>`;\n            cell += `<span class=\"date\">${post.published}</span>`;\n            cell += `</a>`;\n          }\n        } else {\n          cell += `<span class=\"no-post\">${item.feed?.length > 0 ? 'RSS 解析失败' : '未设置 RSS 链接'}</span>`;\n        }\n        cell += `</div>`;\n        cell += `</div>`;\n        cell += `</div>`;\n        cellALL += cell;\n      });\n      \n      el.querySelector('.grid-box').innerHTML = cellALL;\n    }, function () {\n      try {\n        el.querySelector('.loading-wrap svg').remove();\n        el.querySelector('.loading-wrap p').innerText('加载失败，请稍后重试。');\n      } catch (e) { }\n    });\n  },\n  start: () => {\n    const els = document.getElementsByClassName('users-posts-wrap');\n    for (var i = 0; i < els.length; i++) {\n      const el = els[i];\n      const api = el.getAttribute('api');\n      if (api == null) {\n        continue;\n      }\n      var cfg = new Object();\n      cfg.el = el;\n      cfg.api = api;\n      cfg.class = el.getAttribute('class');\n      cfg.avatar = volantis.GLOBAL_CONFIG.default.avatar;\n      FpostsJS.layout(cfg);\n    }\n  }\n}\n\n\n\nFpostsJS.start();\n"]}