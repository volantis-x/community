{"version":3,"sources":["js/plugins/tags/friends.js"],"names":["FriendsJS","requestAPI","url","callback","timeout","retryTimes","request","Promise","resolve","reject","status","timer","setTimeout","fetch","then","response","clearTimeout","ok","json","Error","data","error","layout","cfg","el","api","querySelector","remove","arr","content","cellALL","forEach","item","i","user","title","avatar","innerHTML","innerText","e","start","els","document","getElementsByClassName","length","getAttribute","Object","volantis","GLOBAL_CONFIG","addEventListener"],"mappings":"AAAA,aAAA,IAAMA,UAAY,CAChBC,WAAY,SAACC,EAAKC,EAAUC,GAC1B,IAAIC,EAAa,GAEjB,SAASC,IACP,OAAO,IAAIC,QAAQ,SAACC,EAASC,GAC3B,IAAIC,EAAS,EACTC,EAAQC,WAAW,WACN,IAAXF,IACFA,EAAS,EACTC,EAAQ,KACRF,EAAO,QACW,GAAdJ,GACFD,IAGN,EAAG,KACHS,MAAMX,GAAKY,KAAK,SAAUC,GAOxB,GANe,IAAXL,IACFM,aAAaL,GACbH,EAAQO,GACRJ,EAAQ,KACRD,EAAS,GAEPK,EAASE,GACX,OAAOF,EAASG,OAElB,MAAM,IAAIC,MAAM,+BAClB,GAAGL,KAAK,SAAUM,GAChBf,EAAa,EACbF,EAASiB,EACX,GAAE,SAAO,SAAUC,GACbhB,EAAa,GACfA,GAAc,EACdO,WAAW,WACTN,GACF,EAAG,MAEHF,GAEJ,EACF,EACF,CACAE,EACF,EACAgB,OAAQ,SAACC,GACP,IAAMC,EAAKD,EAAIC,GACfxB,UAAUC,WAAWsB,EAAIE,IAAK,SAAUL,GACtCI,EAAGE,cAAc,iBAAiBC,SAClC,IAAMC,EAAMR,EAAKS,QACbC,EAAU,GACdF,EAAIG,QAAQ,SAACC,EAAMC,GACjB,IAAIC,EAAO,0BACXA,GAAQ,0EACRA,GAAQ,UAAYF,EAAK9B,IAAM,KAC/BgC,GAAQ,aAAeF,EAAKG,MAAQ,WAAaH,EAAKI,QAAUb,EAAIa,QAAU,oCAC9EF,GAAQ,2BAA6BF,EAAKG,MAAQ,gBAClDD,GAAQ,OAERJ,GADAI,GAAQ,QAEV,GACAV,EAAGE,cAAc,eAAeW,UAAYP,CAC9C,EAAG,WACD,IACEN,EAAGE,cAAc,qBAAqBC,SACtCH,EAAGE,cAAc,mBAAmBY,UAAU,cAChD,CAAE,MAAOC,GAAK,CAChB,EACF,EACAC,MAAO,WAEL,IADA,IAAMC,EAAMC,SAASC,uBAAuB,kBACnCV,EAAI,EAAGA,EAAIQ,EAAIG,OAAQX,IAAK,CACnC,IAAMT,EAAKiB,EAAIR,GACTR,EAAMD,EAAGqB,aAAa,OAC5B,GAAW,MAAPpB,EAAJ,CAGA,IAAIF,EAAM,IAAIuB,OACdvB,EAAIC,GAAKA,EACTD,EAAIE,IAAMA,EACVF,EAAG,SAASC,EAAGqB,aAAa,SAC5BtB,EAAIa,OAASW,SAASC,cAAa,WAASZ,OAC5CpC,UAAUsB,OAAOC,EANjB,CAOF,CACF,GAKFvB,UAAUwC,QACVE,SAASO,iBAAiB,gBAAiB,WACzCjD,UAAUwC,OACZ","file":"../../../../js/plugins/tags/friends.js","sourcesContent":["const FriendsJS = {\n  requestAPI: (url, callback, timeout) => {\n    let retryTimes = 5;\n\n    function request() {\n      return new Promise((resolve, reject) => {\n        let status = 0; // 0 等待 1 完成 2 超时\n        let timer = setTimeout(() => {\n          if (status === 0) {\n            status = 2;\n            timer = null;\n            reject('请求超时');\n            if (retryTimes == 0) {\n              timeout();\n            }\n          }\n        }, 5000);\n        fetch(url).then(function (response) {\n          if (status !== 2) {\n            clearTimeout(timer);\n            resolve(response);\n            timer = null;\n            status = 1;\n          }\n          if (response.ok) {\n            return response.json();\n          }\n          throw new Error('Network response was not ok.');\n        }).then(function (data) {\n          retryTimes = 0;\n          callback(data);\n        }).catch(function (error) {\n          if (retryTimes > 0) {\n            retryTimes -= 1;\n            setTimeout(() => {\n              request();\n            }, 5000);\n          } else {\n            timeout();\n          }\n        });\n      });\n    }\n    request();\n  },\n  layout: (cfg) => {\n    const el = cfg.el;\n    FriendsJS.requestAPI(cfg.api, function (data) {\n      el.querySelector('.loading-wrap').remove();\n      const arr = data.content;\n      var cellALL = \"\";\n      arr.forEach((item, i) => {\n        var user = '<div class=\"user-card\">';\n        user += '<a class=\"card-link\" target=\"_blank\" rel=\"external noopener noreferrer\"';\n        user += ' href=\"' + item.url + '\">';\n        user += '<img alt=\"' + item.title + '\" src=\"' + (item.avatar || cfg.avatar) + '\" onerror=\"errorImgAvatar(this)\">';\n        user += '<div class=\"name\"><span>' + item.title + '</span></div>';\n        user += '</a>';\n        user += '</div>';\n        cellALL += user;\n      });\n      el.querySelector('.group-body').innerHTML = cellALL;\n    }, function () {\n      try {\n        el.querySelector('.loading-wrap svg').remove();\n        el.querySelector('.loading-wrap p').innerText('加载失败，请稍后重试。');\n      } catch (e) { }\n    });\n  },\n  start: () => {\n    const els = document.getElementsByClassName('friendsjs-wrap');\n    for (var i = 0; i < els.length; i++) {\n      const el = els[i];\n      const api = el.getAttribute('api');\n      if (api == null) {\n        continue;\n      }\n      var cfg = new Object();\n      cfg.el = el;\n      cfg.api = api;\n      cfg.class = el.getAttribute('class');\n      cfg.avatar = volantis.GLOBAL_CONFIG.default.avatar;\n      FriendsJS.layout(cfg);\n    }\n  }\n}\n\n\n\nFriendsJS.start();\ndocument.addEventListener('pjax:complete', function () {\n  FriendsJS.start();\n});"]}